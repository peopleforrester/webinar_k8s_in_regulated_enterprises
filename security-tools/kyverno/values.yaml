# Kyverno Helm Chart Values
# Version: 1.17.0 (February 2026)
# Features: ValidatingAdmissionPolicy (VAP) auto-generation for API server-level policy execution

# Admission controller settings
admissionController:
  replicas: 3

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Background controller for scanning existing resources
backgroundController:
  replicas: 2

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

# Cleanup controller
cleanupController:
  replicas: 1

# Reports controller
reportsController:
  replicas: 1

# Global settings
config:
  # Exclude system namespaces from policies
  excludeGroups:
    - system:serviceaccounts:kube-system
    - system:serviceaccounts:kyverno

  # Webhook configuration
  webhooks:
    - objectSelector:
        matchExpressions:
          - key: "app.kubernetes.io/managed-by"
            operator: NotIn
            values:
              - Helm

# Enable policy reports
features:
  policyReports:
    enabled: true
  # Enable ValidatingAdmissionPolicy auto-generation (Kyverno 1.17.0+)
  # This allows policies to execute at the API server level for improved
  # performance and reduced webhook overhead. GA targeted for 1.18.
  validatingAdmissionPolicyReports:
    enabled: true

# Auto-generation settings
autogen:
  # Generate ValidatingAdmissionPolicy from ClusterPolicy
  # Policies execute at API server level, eliminating webhook latency
  validatingAdmissionPolicy:
    enabled: true

# Use server-side apply for policy updates
useServerSideApply: true

# Metrics
metricsConfig:
  metricsRefreshInterval: 30s

# Service Monitor for Prometheus
serviceMonitor:
  enabled: true
