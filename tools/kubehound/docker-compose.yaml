# KubeHound Docker Compose Configuration
# Version: 1.6.7 (February 2026)
# Runs KubeHound with JanusGraph backend for attack path analysis
# New in 1.6.7: MITRE ATT&CK framework binding, improved DSL, KHaaS support

services:
  kubehound:
    image: ghcr.io/datadog/kubehound:v1.6.7
    container_name: kubehound
    environment:
      - KUBEHOUND_STORAGE_PROVIDER=janusgraph
      - KUBEHOUND_GRAPH_PROVIDER=janusgraph
      # Enable MITRE ATT&CK mapping for attack paths
      - KUBEHOUND_MITRE_MAPPING=true
    volumes:
      - ${HOME}/.kube/config:/root/.kube/config:ro
      - ./queries:/queries:ro
    depends_on:
      janusgraph:
        condition: service_healthy
    networks:
      - kubehound

  janusgraph:
    image: janusgraph/janusgraph:1.0
    container_name: kubehound-janusgraph
    ports:
      - "8182:8182"
    environment:
      - janusgraph.storage.backend=inmemory
    healthcheck:
      test: ["CMD", "bin/gremlin.sh", "-e", "scripts/empty-sample.groovy"]
      interval: 10s
      timeout: 30s
      retries: 5
    networks:
      - kubehound

  # Graph visualization UI
  graphexp:
    image: bricaud/graphexp:latest
    container_name: kubehound-graphexp
    ports:
      - "8183:80"
    depends_on:
      janusgraph:
        condition: service_healthy
    networks:
      - kubehound

networks:
  kubehound:
    driver: bridge
